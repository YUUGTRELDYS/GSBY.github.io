<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMod Server | YUUGTRELDYS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f5f7fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: #1a2639;
            line-height: 1.5;
        }

        .navbar {
            background: white;
            border-bottom: 1px solid #e1e8f0;
            padding: 16px 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-weight: 600;
            font-size: 1.3rem;
            color: #0b1e33;
        }

        .logo span {
            color: #3b82f6;
            margin-left: 4px;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #94a3b8;
        }

        .dot.online {
            background: #10b981;
        }

        .container {
            max-width: 1200px;
            margin: 32px auto;
            padding: 0 24px;
        }

        .grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #eef2f6;
            overflow: hidden;
        }

        .card-header {
            padding: 18px 24px;
            border-bottom: 1px solid #eef2f6;
            background: #fafbfc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-weight: 500;
            font-size: 1rem;
            color: #334155;
            letter-spacing: 0.3px;
        }

        .card-body {
            padding: 24px;
        }

        .stats-row {
            display: flex;
            gap: 24px;
            margin-bottom: 24px;
        }

        .stat {
            flex: 1;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 500;
            color: #0f172a;
        }

        .progress {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-bar {
            height: 100%;
            background: #3b82f6;
            width: 0%;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            text-align: left;
            font-size: 0.8rem;
            font-weight: 500;
            color: #64748b;
            padding: 12px 0;
            border-bottom: 1px solid #eef2f6;
        }

        .table td {
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .player {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-avatar {
            width: 28px;
            height: 28px;
            background: #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #475569;
        }

        .ping {
            font-size: 0.9rem;
            color: #475569;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #1e293b;
        }

        .btn:hover {
            background: #f8fafc;
            border-color: #94a3b8;
        }

        .btn-primary {
            background: #2563eb;
            border-color: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-success {
            background: #059669;
            border-color: #059669;
            color: white;
        }

        .btn-danger {
            background: #dc2626;
            border-color: #dc2626;
            color: white;
        }

        .control-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .control-btn {
            width: 100%;
            padding: 12px;
            text-align: left;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .control-btn:hover {
            background: #f8fafc;
            border-color: #94a3b8;
        }

        .console {
            background: #0f172a;
            color: #e2e8f0;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 0.85rem;
            padding: 16px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            margin: 16px 0;
        }

        .console-line {
            color: #94a3b8;
            margin-bottom: 4px;
            border-bottom: 1px solid #1e293b;
            padding-bottom: 4px;
        }

        .console-input {
            display: flex;
            gap: 8px;
        }

        .console-input input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-family: 'Menlo', monospace;
            font-size: 0.9rem;
        }

        .select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            margin-bottom: 16px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .setting label {
            display: block;
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        .setting input, .setting select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
        }

        footer {
            margin-top: 48px;
            padding: 24px 0;
            border-top: 1px solid #eef2f6;
            text-align: center;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .badge {
            background: #f1f5f9;
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #475569;
        }

        .alert {
            background: #fef9c3;
            border: 1px solid #fde047;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 24px;
            color: #854d0e;
            font-size: 0.9rem;
            display: none;
        }

        @media (max-width: 800px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .stats-row {
                flex-direction: column;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                GMOD<span>YUUGTRELDYS</span>
            </div>
            <div class="status-badge">
                <span class="dot" id="statusDot"></span>
                <span id="statusText">проверка</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="alert" id="serverAlert">
            сервер не запущен
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <h3>система</h3>
                    <span class="badge">обновление 5с</span>
                </div>
                <div class="card-body">
                    <div class="stats-row">
                        <div class="stat">
                            <div class="stat-label">cpu</div>
                            <div class="stat-value" id="cpuVal">0%</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">ram</div>
                            <div class="stat-value" id="ramVal">0mb</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">uptime</div>
                            <div class="stat-value" id="uptimeVal">0ч</div>
                        </div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" id="cpuBar" style="width:0%"></div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" id="ramBar" style="width:0%"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>управление</h3>
                </div>
                <div class="card-body">
                    <div class="control-grid">
                        <button class="control-btn" id="startBtn">▶ запустить</button>
                        <button class="control-btn" id="restartBtn">↻ перезапуск</button>
                        <button class="control-btn" id="stopBtn">⬛ остановить</button>
                        <button class="control-btn" id="updateAddonsBtn">⟳ обновить аддоны</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>игроки <span id="playersCount" style="margin-left:12px; color:#2563eb;">0</span></h3>
                <button class="btn" id="refreshPlayers">⟳</button>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ник</th>
                            <th>время</th>
                            <th>пинг</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="playersList">
                        <tr>
                            <td colspan="4" style="text-align:center; padding:32px; color:#94a3b8;">нет данных</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="grid" style="margin-top:24px;">
            <div class="card">
                <div class="card-header">
                    <h3>консоль</h3>
                </div>
                <div class="card-body">
                    <div class="console" id="console">
                        <div class="console-line">> system ready</div>
                    </div>
                    <div class="console-input">
                        <input type="text" id="cmdInput" placeholder="команда">
                        <button class="btn" id="sendCmd">→</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>карта <span id="mapName" style="color:#2563eb;">gm_construct</span></h3>
                </div>
                <div class="card-body">
                    <select class="select" id="mapSelect">
                        <option value="gm_construct">gm_construct</option>
                        <option value="gm_flatgrass">gm_flatgrass</option>
                        <option value="gm_bigcity">gm_bigcity</option>
                        <option value="rp_downtown_v2">rp_downtown_v2</option>
                        <option value="cs_office">cs_office</option>
                        <option value="de_dust2">de_dust2</option>
                    </select>
                    <button class="btn-primary" style="width:100%; padding:10px;" id="changeMapBtn">сменить</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>параметры</h3>
            </div>
            <div class="card-body">
                <div class="settings-grid">
                    <div class="setting">
                        <label>порт</label>
                        <input type="text" value="27015" id="port">
                    </div>
                    <div class="setting">
                        <label>макс игроков</label>
                        <input type="text" value="15" id="max">
                    </div>
                    <div class="setting">
                        <label>тикрейт</label>
                        <select id="tick">
                            <option value="33">33</option>
                            <option value="66" selected>66</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <div class="setting">
                        <label>режим</label>
                        <select id="mode">
                            <option value="sandbox" selected>sandbox</option>
                            <option value="terrortown">terrortown</option>
                            <option value="darkrp">darkrp</option>
                            <option value="deathrun">deathrun</option>
                        </select>
                    </div>
                </div>
                <button class="btn-primary" style="margin-top:20px; width:100%; padding:10px;" id="saveSettings">сохранить</button>
            </div>
        </div>

        <footer>
            gmod server · by yuugtrel dys
        </footer>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8765';
        const AUTH_TOKEN = 'YOUR_SECRET_TOKEN';
        
        let online = false;
        let players = [];

        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const serverAlert = document.getElementById('serverAlert');
        const cpuVal = document.getElementById('cpuVal');
        const ramVal = document.getElementById('ramVal');
        const uptimeVal = document.getElementById('uptimeVal');
        const cpuBar = document.getElementById('cpuBar');
        const ramBar = document.getElementById('ramBar');
        const playersCount = document.getElementById('playersCount');
        const playersList = document.getElementById('playersList');
        const consoleDiv = document.getElementById('console');
        const mapName = document.getElementById('mapName');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const stopBtn = document.getElementById('stopBtn');
        const updateAddonsBtn = document.getElementById('updateAddonsBtn');
        const refreshBtn = document.getElementById('refreshPlayers');
        const sendCmd = document.getElementById('sendCmd');
        const cmdInput = document.getElementById('cmdInput');
        const mapSelect = document.getElementById('mapSelect');
        const changeMapBtn = document.getElementById('changeMapBtn');
        const saveBtn = document.getElementById('saveSettings');
        const port = document.getElementById('port');
        const max = document.getElementById('max');
        const tick = document.getElementById('tick');
        const mode = document.getElementById('mode');

        async function apiRequest(endpoint, method = 'GET', data = null) {
            const headers = {
                'X-Auth-Token': AUTH_TOKEN,
                'Content-Type': 'application/json'
            };

            const options = {
                method: method,
                headers: headers
            };

            if (data) {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(API_URL + endpoint, options);
                if (!response.ok) {
                    throw new Error('API error');
                }
                return await response.json();
            } catch (error) {
                console.error('API request failed:', error);
                return null;
            }
        }

        async function updateStatus() {
            const data = await apiRequest('/api/status');
            if (data) {
                online = data.online;
                
                if (online) {
                    statusDot.className = 'dot online';
                    statusText.innerText = 'работает';
                    serverAlert.style.display = 'none';
                    cpuVal.innerText = data.cpu + '%';
                    ramVal.innerText = Math.round(data.ram) + 'mb';
                    uptimeVal.innerText = data.uptime + 'ч';
                    cpuBar.style.width = data.cpu + '%';
                    ramBar.style.width = Math.min((data.ram / 2048) * 100, 100) + '%';
                    playersCount.innerText = data.players;
                    mapName.innerText = data.map;
                } else {
                    statusDot.className = 'dot';
                    statusText.innerText = 'остановлен';
                    serverAlert.style.display = 'block';
                    cpuVal.innerText = '0%';
                    ramVal.innerText = '0mb';
                    uptimeVal.innerText = '0ч';
                    cpuBar.style.width = '0%';
                    ramBar.style.width = '0%';
                    playersCount.innerText = '0';
                    playersList.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:32px; color:#94a3b8;">сервер не запущен</td></tr>';
                    mapName.innerText = 'unknown';
                }
            }
        }

        function log(msg) {
            const line = document.createElement('div');
            line.className = 'console-line';
            line.innerText = '> ' + msg;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            if (consoleDiv.children.length > 30) {
                consoleDiv.removeChild(consoleDiv.children[0]);
            }
        }

        startBtn.onclick = async () => {
            log('запуск сервера...');
            const result = await apiRequest('/api/command', 'POST', { command: 'start' });
            if (result) {
                log('сервер запускается...');
                setTimeout(updateStatus, 2000);
            }
        };

        stopBtn.onclick = async () => {
            log('остановка сервера...');
            const result = await apiRequest('/api/command', 'POST', { command: 'stop' });
            if (result) {
                log('сервер останавливается...');
                setTimeout(updateStatus, 2000);
            }
        };

        restartBtn.onclick = async () => {
            log('перезапуск сервера...');
            const result = await apiRequest('/api/command', 'POST', { command: 'restart' });
            if (result) {
                log('сервер перезапускается...');
                setTimeout(updateStatus, 3000);
            }
        };

        updateAddonsBtn.onclick = async () => {
            log('обновление аддонов...');
            const result = await apiRequest('/api/command', 'POST', { command: 'update_addons' });
            if (result) {
                log('аддоны обновляются...');
            }
        };

        refreshBtn.onclick = () => {
            updateStatus();
            log('статус обновлен');
        };

        sendCmd.onclick = async () => {
            const cmd = cmdInput.value.trim();
            if (!cmd) return;
            
            log('> ' + cmd);
            const result = await apiRequest('/api/command', 'POST', { command: 'console', value: cmd });
            if (result) {
                log('команда отправлена');
            }
            cmdInput.value = '';
        };

        cmdInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendCmd.click();
            }
        });

        changeMapBtn.onclick = async () => {
            const newMap = mapSelect.value;
            const result = await apiRequest('/api/command', 'POST', { command: 'changelevel', value: newMap });
            if (result) {
                mapName.innerText = newMap;
                log('смена карты на ' + newMap);
            }
        };

        saveBtn.onclick = async () => {
            const settings = {
                port: port.value,
                max_players: max.value,
                tickrate: tick.value,
                gamemode: mode.value
            };
            
            const result = await apiRequest('/api/command', 'POST', { command: 'save_settings', settings: settings });
            if (result) {
                log('настройки сохранены');
            }
        };

        window.kick = async (name) => {
            const result = await apiRequest('/api/command', 'POST', { command: 'kick', value: name });
            if (result) {
                log('кик ' + name);
                updateStatus();
            }
        };

        setInterval(updateStatus, 5000);
        updateStatus();
    </script>
</body>
</html>
