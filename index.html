<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMod Server | YUUGTRELDYS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0f172a; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #e2e8f0; }
        .navbar { background: #1e293b; border-bottom: 1px solid #334155; padding: 16px 0; }
        .nav-container { max-width: 1400px; margin: 0 auto; padding: 0 24px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 700; font-size: 1.5rem; background: linear-gradient(135deg, #60a5fa, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo span { background: linear-gradient(135deg, #f472b6, #fb7185); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-left: 4px; }
        .status-badge { display: flex; align-items: center; gap: 12px; background: #0f172a; padding: 8px 16px; border-radius: 30px; border: 1px solid #334155; }
        .dot { width: 12px; height: 12px; border-radius: 50%; background: #64748b; }
        .dot.online { background: #4ade80; box-shadow: 0 0 10px #4ade80; }
        .container { max-width: 1400px; margin: 32px auto; padding: 0 24px; }
        .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 24px; }
        .card { background: #1e293b; border-radius: 16px; border: 1px solid #334155; overflow: hidden; backdrop-filter: blur(10px); }
        .card-header { padding: 18px 24px; border-bottom: 1px solid #334155; background: #0f172a; display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-weight: 600; font-size: 1rem; color: #94a3b8; letter-spacing: 0.5px; text-transform: uppercase; }
        .card-body { padding: 24px; }
        .stats-row { display: flex; gap: 24px; margin-bottom: 24px; }
        .stat { flex: 1; background: #0f172a; padding: 16px; border-radius: 12px; border: 1px solid #334155; }
        .stat-label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; margin-bottom: 8px; }
        .stat-value { font-size: 2rem; font-weight: 700; color: #f1f5f9; }
        .stat-value small { font-size: 0.9rem; color: #64748b; }
        .progress { height: 8px; background: #0f172a; border-radius: 4px; overflow: hidden; margin: 16px 0; border: 1px solid #334155; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); width: 0%; transition: width 0.3s; }
        .table { width: 100%; border-collapse: collapse; }
        .table th { text-align: left; font-size: 0.75rem; font-weight: 600; color: #64748b; padding: 12px 0; border-bottom: 1px solid #334155; text-transform: uppercase; }
        .table td { padding: 12px 0; border-bottom: 1px solid #1e293b; }
        .player { display: flex; align-items: center; gap: 12px; }
        .player-avatar { width: 32px; height: 32px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: white; font-weight: 600; }
        .ping { font-size: 0.9rem; color: #4ade80; font-weight: 600; }
        .btn { padding: 8px 16px; border-radius: 10px; border: 1px solid #334155; background: #0f172a; font-size: 0.9rem; cursor: pointer; transition: all 0.2s; color: #e2e8f0; font-weight: 500; }
        .btn:hover { background: #1e293b; border-color: #4ade80; }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59,130,246,0.4); }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); border: none; color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); border: none; color: white; }
        .control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .control-btn { width: 100%; padding: 12px; text-align: center; background: #0f172a; border: 1px solid #334155; border-radius: 10px; font-size: 0.95rem; cursor: pointer; transition: all 0.2s; color: #e2e8f0; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .control-btn:hover { background: #1e293b; border-color: #3b82f6; }
        .console { background: #0f172a; color: #e2e8f0; font-family: 'Menlo', 'Monaco', monospace; font-size: 0.85rem; padding: 16px; border-radius: 12px; height: 250px; overflow-y: auto; border: 1px solid #334155; }
        .console-line { color: #94a3b8; margin-bottom: 4px; border-bottom: 1px solid #1e293b; padding-bottom: 4px; font-family: 'Consolas', monospace; }
        .console-input { display: flex; gap: 8px; margin-top: 12px; }
        .console-input input { flex: 1; padding: 12px; border: 1px solid #334155; border-radius: 10px; background: #0f172a; color: #e2e8f0; font-family: 'Consolas', monospace; }
        .select { width: 100%; padding: 12px; border: 1px solid #334155; border-radius: 10px; background: #0f172a; color: #e2e8f0; margin-bottom: 16px; }
        .settings-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .setting label { display: block; font-size: 0.8rem; color: #64748b; margin-bottom: 6px; font-weight: 500; }
        .setting input, .setting select { width: 100%; padding: 10px; border: 1px solid #334155; border-radius: 8px; background: #0f172a; color: #e2e8f0; }
        .badge { background: linear-gradient(135deg, #3b82f6, #8b5cf6); padding: 4px 12px; border-radius: 30px; font-size: 0.8rem; color: white; font-weight: 600; }
        .alert { background: #2d1a1a; border: 1px solid #ef4444; border-radius: 12px; padding: 16px; margin-bottom: 24px; color: #fecaca; display: none; }
        .ip-box { background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 8px 12px; display: flex; align-items: center; gap: 8px; font-family: 'Consolas', monospace; }
        .ip-box span { color: #4ade80; font-weight: 600; }
        footer { margin-top: 48px; padding: 24px 0; border-top: 1px solid #334155; text-align: center; color: #64748b; }
        @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } .stats-row { flex-direction: column; } }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                GMOD<span>YUUGTRELDYS</span>
            </div>
            <div class="status-badge">
                <span class="dot" id="statusDot"></span>
                <span id="statusText">–ø—Ä–æ–≤–µ—Ä–∫–∞</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="alert" id="serverAlert">
            ‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <h3>—Å–∏—Å—Ç–µ–º–∞</h3>
                    <span class="badge">live</span>
                </div>
                <div class="card-body">
                    <div class="stats-row">
                        <div class="stat">
                            <div class="stat-label">cpu</div>
                            <div class="stat-value" id="cpuVal">0<small>%</small></div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">ram</div>
                            <div class="stat-value" id="ramVal">0<small>mb</small></div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">uptime</div>
                            <div class="stat-value" id="uptimeVal">0<small>—á</small></div>
                        </div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" id="cpuBar" style="width:0%"></div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" id="ramBar" style="width:0%"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                </div>
                <div class="card-body">
                    <div class="control-grid">
                        <button class="control-btn" id="startBtn"><span>‚ñ∂</span> –∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
                        <button class="control-btn" id="restartBtn"><span>‚Üª</span> –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫</button>
                        <button class="control-btn" id="stopBtn"><span>‚¨õ</span> –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <button class="control-btn" id="updateAddonsBtn"><span>‚ü≥</span> –∞–¥–¥–æ–Ω—ã</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>–∏–≥—Ä–æ–∫–∏ <span id="playersCount" style="margin-left:12px; color:#4ade80;">0</span></h3>
                <button class="btn" id="refreshPlayers">‚ü≥</button>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–Ω–∏–∫</th>
                            <th>–≤—Ä–µ–º—è</th>
                            <th>–ø–∏–Ω–≥</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="playersList">
                        <tr>
                            <td colspan="4" style="text-align:center; padding:32px; color:#64748b;">–Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="grid" style="margin-top:24px;">
            <div class="card">
                <div class="card-header">
                    <h3>–∫–æ–Ω—Å–æ–ª—å</h3>
                </div>
                <div class="card-body">
                    <div class="console" id="console">
                        <div class="console-line">> system ready</div>
                    </div>
                    <div class="console-input">
                        <input type="text" id="cmdInput" placeholder="–≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É...">
                        <button class="btn btn-primary" id="sendCmd">‚Üí</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>–∫–∞—Ä—Ç–∞ <span id="mapName" style="color:#4ade80;">gm_construct</span></h3>
                </div>
                <div class="card-body">
                    <select class="select" id="mapSelect"></select>
                    <button class="btn-primary" style="width:100%; padding:12px;" id="changeMapBtn">—Å–º–µ–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>ip –∞–¥—Ä–µ—Å–∞</h3>
            </div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                        <div style="color:#64748b; margin-bottom:8px;">–ª–æ–∫–∞–ª—å–Ω—ã–π ip</div>
                        <div class="ip-box" id="localIp">
                            <span>üåê</span> 127.0.0.1:27015
                        </div>
                    </div>
                    <div>
                        <div style="color:#64748b; margin-bottom:8px;">–≤–Ω–µ—à–Ω–∏–π ip</div>
                        <div class="ip-box" id="fakeIp">
                            <span>üåç</span> 0.0.0.0:27015
                        </div>
                    </div>
                </div>
                <div style="margin-top:16px; color:#64748b; font-size:0.9rem;">
                    ‚ö° –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: steam://connect/[ip]:[port]
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞</h3>
            </div>
            <div class="card-body">
                <div class="settings-grid">
                    <div class="setting">
                        <label>–Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="serverName" value="Welcome Y Server">
                    </div>
                    <div class="setting">
                        <label>–ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="password" placeholder="–±–µ–∑ –ø–∞—Ä–æ–ª—è">
                    </div>
                    <div class="setting">
                        <label>–ø–æ—Ä—Ç</label>
                        <input type="text" id="port" value="27015">
                    </div>
                    <div class="setting">
                        <label>–º–∞–∫—Å –∏–≥—Ä–æ–∫–æ–≤</label>
                        <input type="number" id="max" value="15" min="1" max="64">
                    </div>
                    <div class="setting">
                        <label>—Ç–∏–∫—Ä–µ–π—Ç</label>
                        <select id="tick">
                            <option value="33">33</option>
                            <option value="66" selected>66</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <div class="setting">
                        <label>—Ä–µ–∂–∏–º</label>
                        <select id="mode">
                            <option value="sandbox">sandbox</option>
                            <option value="terrortown">terrortown</option>
                            <option value="darkrp">darkrp</option>
                            <option value="deathrun">deathrun</option>
                        </select>
                    </div>
                </div>
                <button class="btn-primary" style="margin-top:20px; width:100%; padding:12px;" id="saveSettings">—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>

        <footer>
            gmod server ¬∑ by yuugtrel dys ¬∑ v2.0
        </footer>
    </div>

    <script>
        async function sendToPython(command, value = null, settings = null) {
            try {
                let data = {command: command};
                if (value !== null) data.value = value;
                if (settings !== null) data.settings = settings;
                return JSON.parse(await bridge.sendCommand(JSON.stringify(data)));
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞:', e);
                return null;
            }
        }

        async function updateAll() {
            try {
                let status = await sendToPython('get_status');
                let settings = await sendToPython('get_settings');
                let maps = await sendToPython('get_maps');
                let players = await sendToPython('get_players');
                
                let dot = document.getElementById('statusDot');
                let text = document.getElementById('statusText');
                let alert = document.getElementById('serverAlert');
                
                if (status && status.online) {
                    dot.className = 'dot online';
                    text.innerText = '—Ä–∞–±–æ—Ç–∞–µ—Ç';
                    alert.style.display = 'none';
                } else {
                    dot.className = 'dot';
                    text.innerText = '–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                    alert.style.display = 'block';
                }
                
                if (status) {
                    document.getElementById('mapName').innerText = status.map || 'gm_construct';
                    document.getElementById('playersCount').innerText = status.players || 0;
                    document.getElementById('cpuVal').innerHTML = (status.cpu || 0) + '<small>%</small>';
                    document.getElementById('ramVal').innerHTML = (status.ram || 0) + '<small>mb</small>';
                    document.getElementById('uptimeVal').innerHTML = (status.uptime || 0) + '<small>—á</small>';
                    document.getElementById('cpuBar').style.width = (status.cpu || 0) + '%';
                    document.getElementById('ramBar').style.width = Math.min((status.ram || 0) / 20, 100) + '%';
                    
                    if (status.ip) {
                        document.getElementById('localIp').innerHTML = '<span>üåê</span> ' + status.ip + ':' + status.port;
                    }
                    if (status.fake_ip) {
                        document.getElementById('fakeIp').innerHTML = '<span>üåç</span> ' + status.fake_ip + ':' + status.port;
                    }
                }
                
                if (settings) {
                    if (document.getElementById('serverName')) document.getElementById('serverName').value = settings.server_name || 'Welcome Y Server';
                    if (document.getElementById('port')) document.getElementById('port').value = settings.server_port || '27015';
                    if (document.getElementById('max')) document.getElementById('max').value = settings.max_players || 15;
                    if (document.getElementById('mode')) document.getElementById('mode').value = settings.gamemode || 'sandbox';
                }
                
                let select = document.getElementById('mapSelect');
                if (select && maps && maps.length > 0) {
                    let current = select.value;
                    select.innerHTML = '';
                    maps.forEach(m => {
                        let opt = document.createElement('option');
                        opt.value = m;
                        opt.text = m;
                        select.appendChild(opt);
                    });
                    if (current && maps.includes(current)) select.value = current;
                }
                
                let tbody = document.getElementById('playersList');
                if (tbody) {
                    if (players && players.length > 0) {
                        let html = '';
                        players.forEach(p => {
                            html += '<tr><td><div class="player"><div class="player-avatar">' + 
                                   (p.name ? p.name[0] : '?') + '</div>' + (p.name || 'Player') + '</div></td><td>' + 
                                   (p.time || '0m') + '</td><td><span class="ping">' + (p.ping || 0) + 'ms</span></td>' +
                                   '<td><button class="btn kick-btn" data-player="' + (p.name || '') + '" style="padding:4px 8px;">kick</button></td></tr>';
                        });
                        tbody.innerHTML = html;
                    } else {
                        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:32px; color:#64748b;">–Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</td></tr>';
                    }
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', e);
            }
        }

        document.addEventListener('click', async function(e) {
            let target = e.target;
            
            if (target.id === 'startBtn' || target.closest('#startBtn')) {
                e.preventDefault();
                await sendToPython('start');
                setTimeout(updateAll, 1000);
            }
            
            if (target.id === 'stopBtn' || target.closest('#stopBtn')) {
                e.preventDefault();
                await sendToPython('stop');
                setTimeout(updateAll, 1000);
            }
            
            if (target.id === 'restartBtn' || target.closest('#restartBtn')) {
                e.preventDefault();
                await sendToPython('restart');
                setTimeout(updateAll, 2000);
            }
            
            if (target.id === 'changeMapBtn' || target.closest('#changeMapBtn')) {
                e.preventDefault();
                let map = document.getElementById('mapSelect');
                if (map) {
                    await sendToPython('changelevel', map.value);
                }
            }
            
            if (target.id === 'sendCmd' || target.closest('#sendCmd')) {
                e.preventDefault();
                let input = document.getElementById('cmdInput');
                if (input && input.value) {
                    await sendToPython('console', input.value);
                    input.value = '';
                }
            }
            
            if (target.id === 'saveSettings' || target.closest('#saveSettings')) {
                e.preventDefault();
                let settings = {
                    server_name: document.getElementById('serverName')?.value,
                    server_port: document.getElementById('port')?.value,
                    max_players: document.getElementById('max')?.value,
                    gamemode: document.getElementById('mode')?.value,
                    map: document.getElementById('mapSelect')?.value,
                    tickrate: document.getElementById('tick')?.value,
                    server_password: document.getElementById('password')?.value
                };
                await sendToPython('save_settings', null, settings);
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            }
            
            if (target.classList.contains('kick-btn')) {
                e.preventDefault();
                let name = target.getAttribute('data-player');
                if (name) {
                    await sendToPython('kick', name);
                    setTimeout(updateAll, 1000);
                }
            }
            
            if (target.id === 'refreshPlayers' || target.closest('#refreshPlayers')) {
                e.preventDefault();
                updateAll();
            }
        });

        document.getElementById('cmdInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('sendCmd').click();
            }
        });

        setInterval(updateAll, 2000);
        setTimeout(updateAll, 500);
    </script>
</body>
</html>
